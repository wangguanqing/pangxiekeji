var TouTiao={};!function(){function e(e){var n=!0,o=document.querySelector("header #toggle_img"),i=document.querySelectorAll(".relate_video img"),r=t();if(("0"==e||"none"==e)&&(n=!1),o&&(o.style.display=n?"none":"block"),r.length&&n){for(var a=0,l=i.length;l>a;a++){var c=i[a],s=c.getAttribute("alt_src");s&&(c.src=s)}for(var u=0,d=r.length;d>u;u++){var f=r[u],v=f.getAttribute("alt_src");v&&(f.src=v)}}}function t(){var e=document.querySelectorAll("article img"),t=e.length,n=document.querySelector("header #toggle_img");if(!t)return n&&(n.style.display="none"),[];var o=document.querySelector("article").offsetWidth;/Android 2.3/g.test(L)&&(o=290),o||(o=200);for(var i=0;t>i;i++){var r=e[i],a=r.getAttribute("alt_width")||r.getAttribute("width");if(r.removeAttribute("style"),a){a=parseInt(a);var l=r.getAttribute("alt_height")||r.getAttribute("height");if(!l)continue;var c=o>a?a:o,s=parseInt(l*c/a);r.setAttribute("width",c),r.setAttribute("height",s)}}return e}function n(e){function t(e){for(var t=i.querySelectorAll(e),n=t.length,o=n-1;o>=0;o--){var r=t[o];r.innerHTML=r.innerHTML.trim(),r.removeAttribute("style")}}function n(e){for(var t=i.querySelectorAll(e),n=t.length,o=0;n>o;o++){var r=t[o];r.outerHTML=r.innerHTML.trim()}}var o=document.querySelector(e),i=null;if(o){i=o.cloneNode(!0),t("p"),t("span"),t("strong"),n("font"),n("br");for(var r=i.querySelectorAll("a"),a=r.length,l=0;a>l;l++){var c=r[l],s=c.href;/^http/.test(s)&&(c.removeAttribute("href"),c.outerHTML=c.innerHTML)}o.innerHTML=i.innerHTML.replace(/&nbsp;*/g,"")}}function o(){var e="none",o=!1,l=document.referrer.indexOf("nativeapp.toutiao.com")<0,s=document.querySelector("article");if(s&&(e="article"),document.querySelector("video")&&(o=!0),"article"==e){if(f(4.9)&&m(document.body,"app49plus"),t(),n("article"),c(),!x&&l?(TouTiao.articleId=v("tt_group_id"),h("http://s0.pstatp.com/css/toutiao/wap_flow.css"),g("http://s0.pstatp.com/inapp/TTRelateJS.js")):x&&f(4.5)&&g("http://s0.pstatp.com/inapp/toutiao.js?ver=20150410",function(){var e=!0;q||f(5.2)||(e=!1),e&&i()}),o&&x){var u=!1;!q&&f(4.5)&&(u=!0),u?(E.app45plusinit(),"function"==typeof videoAutoPlayCallback&&videoAutoPlayCallback()):E.TTVideoInit()}w(s),a()}x&&(location.href="bytedance://domReady",r())}function i(){for(var e=document.querySelectorAll("article img"),t=[],n=[],o=0,i=e.length;i>o;o++){var r=e[o],a=r.src;a&&(n.push(a),t.push(r))}for(var l=0,c=n.length;c>l;l++)t[l].addEventListener("click",function(){var e=this.src,t=n.indexOf(e);-1!=t&&ToutiaoJSBridge.call("gallery",{images:n,index:t},null)},!1)}function r(){var e=location.href,t="";-1!=e.indexOf("sports.letv.com/ttlive")&&(t="live_leshi_long"),-1!=e.indexOf("lives.sina.cn/live/live")&&(t="live_pic_sina_long"),-1!=e.indexOf("m.ssports.smgbb.cn")&&(t="live_xinying_long"),t&&setTimeout(function(){var e="bytedance://"+(q?"log_event":"custom_event")+"?category=umeng&tag=widget&label="+t;location.href=e},3e4)}function a(){var e=document.querySelectorAll(".long-star")[0],t=/^(0|[1-9]|10)$/,n="",o="";if(e)if(t.test(e.innerHTML)){for(var i=e.innerHTML||0,r=Math.floor(i/2),a=i%2==1?1:0,l=5-r-a,c=1==a?'<a class="star halfstar"></a>':"",s=0;r>s;s++)n+='<a class="star fullstar"></a>';for(var u=0;l>u;u++)o+='<a class="star nullstar"></a>';e.innerHTML=n+c+o}else{for(var u=0;5>u;u++)o+='<a class="star nullstar"></a>';e.innerHTML=o}}function l(e,t,n){var o,i=e(),r=0;i?t(i):o=setInterval(function(){i=e(),r++,(i||r>n)&&(clearInterval(o),i&&t(i))},200)}function c(){var t=p("tt_daymode"),n=p("tt_font"),o=p("tt_image")||"";t&&u(t),n&&s(n),e(o)}function s(e){["s","m","l","xl"].indexOf(e)>-1&&(b(S,"font_s font_m font_l font_xl"),m(S,"font_"+e))}function u(e,t){["0","1",0,1].indexOf(e)<0||(e=parseInt(e),e?b(S,"night"):m(S,"night"),t&&t(e))}function d(){var e=document.querySelector("#TouTiaoBar");e&&(e.style.display="none")}function f(e){var t=/NewsArticle\/(\d\.\d)/i.exec(L),n=0;if(t)var n=t[1];return n>=e}function v(e){var t=location.search.substr(1),n={};if(t)for(var o=t.split("&"),i=0;i<o.length;i++){var r=o[i].split("=");n[r[0]]=r[1]}return n[e.toLowerCase()]||""}function p(e){var t=location.hash.substr(1),n={};if(t)for(var o=t.split("&"),i=0;i<o.length;i++){var r=o[i].split("=");n[r[0]]=r[1]}if("string"==typeof e)return n[e];if("object"==typeof e){for(var a in e)n[a]=e[a];var l="";for(var c in n)l+=c+"="+n[c]+"&";location.href="#"+l.substring(0,l.length-1)}}function g(e,t){var n,o=document.head;n=document.createElement("script"),n.async=!1,n.type="text/javascript",n.charset="utf-8",n.src=e,o.insertBefore(n,o.firstChild),t&&n.addEventListener("load",t,!1)}function h(e,t){var n,o=document.head;n=document.createElement("link"),n.rel="stylesheet",n.type="text/css",n.href=e,o.insertBefore(n,o.firstChild),t&&n.addEventListener("load",t,!1)}function y(e,t){var n=new RegExp("(\\s|^)"+t+"(\\s|$)");return n.test(e.className)}function m(e,t){t.split(/\s+/).forEach(function(t){y(e,t)||(e.className+=" "+t)})}function b(e,t){t.split(/\s+/).forEach(function(t){var n=new RegExp("(\\s|^)"+t+"(\\s|$)");e.className=e.className.replace(n," ")})}function T(e){"object"==typeof TTAndroidObject?TTAndroidObject.reportLocalEvent(e):console.log(e)}function _(){this.style.opacity="0"}function A(){this.style.opacity="1"}function w(e){function t(e){e&&0==this.scrollLeft&&(e.style.opacity=1)}if(e){var n=e.querySelectorAll("table"),o=n.length,i=0;if(0!=o){i=e.offsetWidth;for(var r=0;o>r;r++){var a=n[r],l=a.getBoundingClientRect(),c=l.right-l.left;if(c>i){var s=document.createElement("div"),u=a.cloneNode(!0),d=document.createElement("div");u.className+=" border",s.className="horizontal_scroll",s.appendChild(u),a.parentNode.replaceChild(s,a),d.className="swipe_tip",d.innerHTML="左滑查看更多",s.appendChild(d),s.addEventListener("touchstart",function(){d.style.opacity=0},!1),s.addEventListener("scroll",function(){t.call(this,d)},!1),s.addEventListener("touchend",function(){t.call(this,d)},!1),x&&q&&console.log("bytedance://disable_swipe")}}}}}var L=navigator.userAgent,S=document.querySelector("body"),q=/Android/i.test(L),x=/(news|explore)[_]?article/i.test(L),E={autoplayed:!1,valid_videos:[],TTVideoInit:function(){if(q&&x)for(var e=document.querySelectorAll(".video_container"),t='<a class="cover"><img src="${poster_url}"/></a><a class="trigger" href="bytedance://video?json=0&play_url=${play_url}"></a>',n=0,o=e.length;o>n;n++){var i=e[n],r=i.querySelector("video"),a=t;r&&(r.getAttribute("live")||l(function(){return r.getAttribute("src")},function(e){var t={play_url:encodeURIComponent(e),poster_url:r.getAttribute("poster")||""};for(k in t)a=a.replace("${"+k+"}",t[k]);i.innerHTML=a},10))}},TTVideoInitPro:function(){var e=this,t=document.querySelectorAll(".video_container"),n=t.length,o=document.body.clientWidth,i="56.25%";o&&(i=parseInt(.5625*o)+"px");for(var r=0;n>r;r++){var a=t[r],c=a.querySelector("video");c&&l(function(){return c.getAttribute("src")},function(t){if(t){t=encodeURIComponent(t);var n=c.getAttribute("poster")||"";if(a.style.cssText="padding-bottom:"+i+";height:0;overflow:hidden;background:#000 no-repeat center;background-size:contain;",a.setAttribute("data-url",t),a.innerHTML='<a class="trigger"></a>',n){var o=new Image;o.onload=function(){a.style.backgroundImage="url("+n+")"},o.src=n}e.valid_videos.push(a),a.addEventListener("click",function(){E.playVideo(this,0)},!1)}},10)}},playVideo:function(e,t){var n,o,i=this,r=e.getAttribute("data-url");l(function(){return"object"==typeof window.ToutiaoJSBridge},function(){n=e.getBoundingClientRect(),o=[n.left,e.offsetTop,n.width,n.height],window.ToutiaoJSBridge.call("playVideo",{url:r,frame:o},q?i.video_cb:null)},10),t||(i.autoplayed=!0)},video_cb:function(e){if(1==e.code){var t=document.querySelector('[data-url="'+e.url+'"]');t&&(t.style.display="none",document.body.style.marginTop=e.height+"px")}},appCloseVideoNoticeWeb:function(e){var t=document.querySelector('[data-url="'+e+'"]');t&&(t.style.display="block",document.body.style.marginTop="0px")},_videoInView:function(e){var t=e.getBoundingClientRect(),n=t.height||100;return(t.top>=0&&t.left>=0&&t.top)<=(window.innerHeight||document.documentElement.clientHeight)-n},videoAutoPlay:function(){l(function(){return E.valid_videos.length},function(e){if(e)if(E.autoplayed)document.removeEventListener("scroll",E.videoAutoPlay,!1);else{var t=E.valid_videos[0];E._videoInView(t)?(E.playVideo(t,1),E.autoplayed=!0):document.addEventListener("scroll",E.videoAutoPlay,!1)}},10)},app45plusinit:function(){window.videoAutoPlay=this.videoAutoPlay,window.appCloseVideoNoticeWeb=this.appCloseVideoNoticeWeb,this.TTVideoInitPro()}};document.addEventListener("DOMContentLoaded",o,!1),window.onhashchange=c,window.errorimg=_,window.loadimg=A,window.androidReportEvent=T,TouTiao.showImage=e,TouTiao.setFontSize=s,TouTiao.setDayMode=u,TouTiao.hideBar=d,TouTiao.hash=p}();